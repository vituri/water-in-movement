<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.13">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content=" Lucas Vituri Santarosa">
<meta name="author" content=" Guilherme Vituri Fernandes Pinto">

<title>2&nbsp; POTENTIAL AQUIFER RECHARGE THROUGH REMOTE SENSING – Water in movement</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./summary.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-66ab7fd5e73b7f0a764e0d49b3e29ab1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-fe03c880b9649909602f2b6bf9a9b50e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./potential-recharge.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">POTENTIAL AQUIFER RECHARGE THROUGH REMOTE SENSING</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Water in movement</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/vituri/water-in-movement" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Water-in-movement.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Water-in-movement.epub">
              <i class="bi bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./potential-recharge.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">POTENTIAL AQUIFER RECHARGE THROUGH REMOTE SENSING</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract"><span class="header-section-number">2.1</span> Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2.2</span> Introduction</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset"><span class="header-section-number">2.3</span> Dataset</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology"><span class="header-section-number">2.4</span> Methodology</a>
  <ul class="collapse">
  <li><a href="#determination-of-the-curve-number-cn" id="toc-determination-of-the-curve-number-cn" class="nav-link" data-scroll-target="#determination-of-the-curve-number-cn"><span class="header-section-number">2.4.1</span> Determination of the Curve Number (CN)</a></li>
  <li><a href="#calculation-of-maximum-potential-retention-s" id="toc-calculation-of-maximum-potential-retention-s" class="nav-link" data-scroll-target="#calculation-of-maximum-potential-retention-s"><span class="header-section-number">2.4.2</span> Calculation of Maximum Potential Retention (S)</a></li>
  <li><a href="#estimation-of-initial-abstraction-ia" id="toc-estimation-of-initial-abstraction-ia" class="nav-link" data-scroll-target="#estimation-of-initial-abstraction-ia"><span class="header-section-number">2.4.3</span> Estimation of Initial Abstraction (Ia)</a></li>
  <li><a href="#runoff-calculation" id="toc-runoff-calculation" class="nav-link" data-scroll-target="#runoff-calculation"><span class="header-section-number">2.4.4</span> Runoff Calculation</a></li>
  </ul></li>
  <li><a href="#processing" id="toc-processing" class="nav-link" data-scroll-target="#processing"><span class="header-section-number">2.5</span> Processing</a>
  <ul class="collapse">
  <li><a href="#curve-number-calculation" id="toc-curve-number-calculation" class="nav-link" data-scroll-target="#curve-number-calculation"><span class="header-section-number">2.5.1</span> Curve Number Calculation</a></li>
  <li><a href="#land-use-and-land-cover-lulc" id="toc-land-use-and-land-cover-lulc" class="nav-link" data-scroll-target="#land-use-and-land-cover-lulc"><span class="header-section-number">2.5.2</span> Land Use and Land Cover (LULC)</a></li>
  <li><a href="#reclassification-of-mapbiomas-according-to-scs-method" id="toc-reclassification-of-mapbiomas-according-to-scs-method" class="nav-link" data-scroll-target="#reclassification-of-mapbiomas-according-to-scs-method"><span class="header-section-number">2.5.3</span> Reclassification of MAPBIOMAS According to SCS Method</a></li>
  <li><a href="#curve-number-cn-classification" id="toc-curve-number-cn-classification" class="nav-link" data-scroll-target="#curve-number-cn-classification"><span class="header-section-number">2.5.4</span> Curve Number (CN) Classification</a></li>
  <li><a href="#process-the-hydrological-data" id="toc-process-the-hydrological-data" class="nav-link" data-scroll-target="#process-the-hydrological-data"><span class="header-section-number">2.5.5</span> Process the hydrological data</a></li>
  <li><a href="#step-1-a-organize-the-daily-data-set" id="toc-step-1-a-organize-the-daily-data-set" class="nav-link" data-scroll-target="#step-1-a-organize-the-daily-data-set"><span class="header-section-number">2.5.6</span> STEP 1-A Organize the daily data set</a></li>
  <li><a href="#step-1-b-convert-daily-rainfall-in-monthly" id="toc-step-1-b-convert-daily-rainfall-in-monthly" class="nav-link" data-scroll-target="#step-1-b-convert-daily-rainfall-in-monthly"><span class="header-section-number">2.5.7</span> STEP 1-B Convert daily rainfall in monthly</a></li>
  <li><a href="#step-2-resample-curve-number" id="toc-step-2-resample-curve-number" class="nav-link" data-scroll-target="#step-2-resample-curve-number"><span class="header-section-number">2.5.8</span> STEP 2 Resample Curve Number</a></li>
  <li><a href="#step-3-runoff-calculation" id="toc-step-3-runoff-calculation" class="nav-link" data-scroll-target="#step-3-runoff-calculation"><span class="header-section-number">2.5.9</span> STEP 3 Runoff calculation</a></li>
  <li><a href="#step-4-monthly-recharge-calculation" id="toc-step-4-monthly-recharge-calculation" class="nav-link" data-scroll-target="#step-4-monthly-recharge-calculation"><span class="header-section-number">2.5.10</span> STEP 4 Monthly recharge calculation</a></li>
  <li><a href="#clean-temp-files" id="toc-clean-temp-files" class="nav-link" data-scroll-target="#clean-temp-files"><span class="header-section-number">2.5.11</span> CLEAN TEMP FILES</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/vituri/water-in-movement/edit/main/potential-recharge.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">POTENTIAL AQUIFER RECHARGE THROUGH REMOTE SENSING</span></h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"></p><p><br>
Lucas Vituri Santarosa </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            </p><p><br>
            Escuela de Agronomía, Facultad de Ciencias Agronómicas y de los Alimentos, Pontificia Universidad Católica de Valparaíso, Quillota, Chile. lucas.vituri@pucv.cl
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author"></p><p><br>
Guilherme Vituri Fernandes Pinto </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            </p><p><br>
            São Paulo State University (UNESP), Institute of Bioscience, Letters and Exact Sciences, São José do Rio Preto, São Paulo, Brazil. viturivituri@gmail.com
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="abstract" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="abstract"><span class="header-section-number">2.1</span> Abstract</h2>
</section>
<section id="introduction" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2.2</span> Introduction</h2>
<p>Water is fundamental to Earth’s systems, influencing climate, ecosystems, and human activities. The hydrological cycle describes the continuous movement of water through various reservoirs, including the atmosphere, soil, surface water, glaciers, and groundwater. Understanding this cycle is crucial for effective water resource management, particularly in the face of changing climatic conditions and increasing human demands. By quantifying water fluxes within different reservoirs, scientists can assess water availability, identify trends, and develop strategies for sustainable management (Santarosa et al., 2021).</p>
<p>Analyzing the movement of water through these reservoirs is made possible by understanding the mass balance equation for any system at various scales. The mass balance is derived from Reynolds’ transport theorem (Magulis, 2017). The first step in mass balance analysis is defining a control volume or area, followed by identifying the inflows and outflows (Hessels et al., 2022). Hydrological balance equations are essential tools for quantifying water exchanges in each system. These equations provide insights into the relationships between precipitation, evapotranspiration, runoff, and storage changes (Wang et al., 2014).&nbsp; Such variations highlight the need for flexible approaches in hydrological modeling to account for different climatic and geological settings (Lehmann et al., 2022). Data limitations, climatic characteristics, or the temporal scale of the analysis may lead to adaptations of the hydrological balance equation. A simplified form of the water balance equation for a watershed can be expressed as:</p>
<p><span id="eq-linear"><span class="math display">\[
\Delta S = P - ET - Q
\tag{2.1}\]</span></span></p>
<p>where, <span class="math inline">\(\Delta S\)</span>&nbsp;is the change in water storage, P is precipitation, ET is evapotranspiration and Q is surface runoff (Wang et al., 2014; Lehmann at al., 2022). In some cases, where horizontal movement (surface or subsurface runoff) of water is minimal, Q can be omitted (Wang et al., 2014). This type of adjustment in the hydrological balance equation can also be made for other variables to evaluate potential variability or hidden trends in one or more datasets (Luo et al., 2021; Lehmann et al., 2022). Another example of adapting the hydrological balance equation is to estimate groundwater recharge (Baalousha et al., 2018), at multi-annual scales, <span class="math inline">\(\Delta S\)</span>&nbsp;&nbsp;can be disregarded (Crosbie et al., 2015).</p>
<p><span class="math display">\[
R = P - ET - Q - \Delta S
\]</span></p>
<p>Hydrological balances support decision-making and directing water volumes toward necessary uses. The need for new tools to quantify water is increasingly evident, especially in the current context, where water management requires understanding the effects of extreme events caused by climate change and the transformations in hydrological processes driven by anthropogenic activities (Scanlon et al., 2023).</p>
<p>Obtaining high-quality spatiotemporal estimates of hydrological balance components is a challenge due to the lack of <em>in situ</em> measurements and the absence of policies maintaining adequate monitoring networks. In this context, the era of satellite remote sensing offers a promising solution for monitoring the hydrosphere. Due to dedicated satellite missions, it is possible to measure key variables that can be used to estimate the components of the hydrological balance (Lehmann et al., 2022). Advancements in remote sensing, hydrological modeling, and data assimilation techniques have improved the ability to estimate water balance components across various spatial and temporal scales (Hessels et al., 2022). However, uncertainties remain due to limitations in data availability, measurement techniques, and model assumptions (Crosbie et al., 2015).</p>
<p>As an example of hydrological applications based on remote sensing, Lehmann et al.&nbsp;(2022) conducted a global study evaluating the state-of-the-art methods and recent satellite data applied to hydrology, investigating the water balance in the world’s major basins. The authors found good performance of satellite data for estimating changes in water storage. However, they also noted that some satellite products show variations in performance depending on the region, highlighting the importance of carefully evaluating the data used in local studies.</p>
<p>Wang et al.&nbsp;(2014) evaluate the limitations and strengths of satellite data for hydrological balance at the semi-arid basin level across Australia. The authors conclude that the exclusive use of remote sensing data is sufficient to close the hydrological balance in large regions. Luo et al.&nbsp;(2021) analyze different combinations of satellite data to identify those with the lowest errors in estimating the hydrological balance in a basin in China. They highlight the most accurate data as the long-term global precipitation obtained through the combination of microwave and infrared satellite measurements from GPM IMERG (Integrated Multi-satellite Retrievals for Global Precipitation Measurement) (Huffman et al., 2019). Additionally, they mention evapotranspiration, water storage, surface runoff, and other data from large-scale terrestrial hydrological models generated by GLDAS (Global Land Data Assimilation System) (Rui &amp; Beaudoing, 2015; Beaudoing &amp; Rodell, 2016). This system integrates evapotranspiration data through an energy balance scheme (using methods such as Penman-Monteith) based on MODIS (Moderate Resolution Imaging Spectroradiometer) data (Running et al., 2019). Recently, measurements from GRACE (Gravity Recovery and Climate Experiment) have also been incorporated, allowing for the estimation of total water volume (Total Water Storage) (Li et al., 2019).</p>
<p>Given the critical role of groundwater in sustaining water resources, particularly in regions experiencing water scarcity, estimating groundwater recharge is a key aspect of hydrological studies. Recharge estimation methods, such as water balance equations, isotope analysis, and numerical modeling, provide valuable insights into groundwater sustainability (Santarosa et al., 2024). By refining these methods and incorporating advanced data sources, researchers and policymakers can improve water resource planning and develop strategies to mitigate the impacts of climate variability and human activities on aquifers.</p>
<p>The primary aim of this chapter is to demonstrate a recharge estimation based on the water budget method, utilizing an adaptation of Equation 2 for a multiannual scale, as proposed by Santarosa et al.&nbsp;(2024, 2021). The use of remote sensing, implemented in R language, was crucial for various processing steps involving a large dataset, aimed at analyzing the spatial and temporal behavior of aquifer potential recharge.</p>
</section>
<section id="dataset" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="dataset"><span class="header-section-number">2.3</span> Dataset</h2>
<p>The studies by Santarosa et al.&nbsp;(2024; 2021) utilize a consistent data processing methodology but differ in their hydrological and landscape datasets (Table 1). The 2021 study employed precipitation data from the Tropical Rainfall Measuring Mission (TRMM) and the Global Land Data Assimilation System (GLDAS v2.1), both with a daily temporal resolution. The spatial resolution was approximately 25 km for precipitation and evapotranspiration, complemented by 30 m land cover data and soil texture characteristics.</p>
<p>In contrast, the 2024 study refined the methodology by integrating precipitation data from the Integrated Multi-satellite Retrievals for Global Precipitation Measurement (IMERG GPM v6) at a ~10 km resolution, updated evapotranspiration data from GLDAS v2.2, annual land cover maps from MapBiomas (30 m, <a href="https://brasil.mapbiomas.org/" class="uri">https://brasil.mapbiomas.org/</a>), and soil texture information sourced from SoilGrids (250 m, <a href="https://soilgrids.org/" class="uri">https://soilgrids.org/</a>).</p>
<p>The datasets from NASA (National Aeronautics and Space Administration) were downloaded from GESDISC (<a href="https://disc.gsfc.nasa.gov/" class="uri">https://disc.gsfc.nasa.gov/</a>). Detailed instructions for downloading these datasets can be found in the dataset download information. Additionally, Google Collaboratory can be used to download the dataset links (<a href="https://github.com/lvsantarosa/NASA-data-download" class="uri">https://github.com/lvsantarosa/NASA-data-download</a>), and it also supports accessing all mentioned datasets via the Google Earth Engine API.</p>
<p>Table 1. Datasets from Santarosa et al.&nbsp;(2021) and Santarosa et al.&nbsp;(2024)</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Characteristic</strong></td>
<td><strong>Santarosa et al.&nbsp;(2021)</strong></td>
<td><strong>Santarosa et al.&nbsp;(2024)</strong></td>
</tr>
<tr class="even">
<td><strong>Objective</strong></td>
<td>Water budget with precipitation, evapotranspiration, and runoff</td>
<td>Enhanced model with more recent data and improved scalability</td>
</tr>
<tr class="odd">
<td><strong>Precipitation Data</strong></td>
<td>TRMM 3B42 v7</td>
<td>GPM IMERG v6</td>
</tr>
<tr class="even">
<td><strong>Evapotranspiration</strong></td>
<td>GLDAS v2.1</td>
<td>GLDAS v2.2</td>
</tr>
<tr class="odd">
<td><strong>Surface Runoff</strong></td>
<td>SCS-CN with fixed local land use and soil data</td>
<td>SCS-CN with annual data from MapBiomas Brazil and global soil data (SoilGrids)</td>
</tr>
<tr class="even">
<td><strong>Validation</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="methodology" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="methodology"><span class="header-section-number">2.4</span> Methodology</h2>
<p>The Soil Conservation Service (SCS) method is employed to convert rainfall into surface runoff by accounting for the characteristics of land cover and soil texture.</p>
<section id="determination-of-the-curve-number-cn" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="determination-of-the-curve-number-cn"><span class="header-section-number">2.4.1</span> Determination of the Curve Number (CN)</h3>
<p>The CN is derived by integrating soil hydrological characteristics with land use information. In the studies, high-resolution land cover data (e.g., MapBiomas with a 30 m resolution) and soil texture data (e.g., SoilGrids with a 250 m resolution) are combined to assign appropriate CN values for different areas.</p>
</section>
<section id="calculation-of-maximum-potential-retention-s" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="calculation-of-maximum-potential-retention-s"><span class="header-section-number">2.4.2</span> Calculation of Maximum Potential Retention (S)</h3>
<p>Once the CN is established, the potential maximum retention is calculated using the formula:</p>
<p><span class="math display">\[
S = \frac{{25400}}{{CN}}-254
\]</span></p>
<p>This equation converts the CN into a measure of the maximum amount of rainfall that can be retained by the soil.</p>
</section>
<section id="estimation-of-initial-abstraction-ia" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="estimation-of-initial-abstraction-ia"><span class="header-section-number">2.4.3</span> Estimation of Initial Abstraction (Ia)</h3>
<p>The initial abstraction, which includes losses from interception, early infiltration, and surface depression storage, is typically assumed to be 20% of S:</p>
<p><span class="math display">\[
I_{a} = 0.2 S
\]</span></p>
</section>
<section id="runoff-calculation" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="runoff-calculation"><span class="header-section-number">2.4.4</span> Runoff Calculation</h3>
<p>For rainfall events where the daily precipitation P exceeds <span class="math inline">\(I_{a}\)</span>, the runoff is computed with the equation:</p>
<p><span class="math display">\[
R_{off} = \frac{(P-0.2S)^2}{P+0.8S}
\]</span></p>
<p>This empirical formula estimates the portion of rainfall that becomes surface runoff after the initial abstraction is met.</p>
<p>By processing daily rainfall data through these steps, the SCS method generates spatially distributed runoff estimates that are integrated into the overall water balance analysis. This approach is particularly valuable when used in combination with remote sensing data, enabling researchers to capture the spatial variability of runoff across large areas and different land uses.</p>
</section>
</section>
<section id="processing" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="processing"><span class="header-section-number">2.5</span> Processing</h2>
<p>The first step is to load the essential packages: <code>tidyverse</code>, <code>terra</code>, and <code>glue</code>.</p>
<ol type="1">
<li><p><strong>tidyverse</strong>: This package activates a suite of tools for data processing, such as date manipulation, filtering, editing, and selecting information.</p></li>
<li><p><strong>terra</strong>: This package handles the geoprocessing of spatial data.</p></li>
<li><p><strong>glue</strong>: This package is an alternative method for concatenating names in files.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue) </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next step is to specify the working directory (<code>setwd</code>) and create a temporary directory (<code>dir.create</code>) to store processing information, which will be excluded in the final output. This practice helps to ensure that background processing does not consume a lot of space on the hard disk. It is strongly recommended for large spatial and temporal processing tasks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>my_path <span class="ot">=</span> \(x) glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'data/potential-recharge/'</span>, x)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="at">path =</span> <span class="fu">my_path</span>(<span class="st">'temp'</span>), <span class="at">showWarnings =</span> <span class="cn">FALSE</span>) </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">terraOptions</span>(<span class="at">tempdir =</span> <span class="fu">my_path</span>(<span class="st">'temp'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="curve-number-calculation" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="curve-number-calculation"><span class="header-section-number">2.5.1</span> Curve Number Calculation</h3>
<p>Applying the presented methodology, it is necessary to combine the Hydrologic Soil Group (HSG) information with Land Use Land Cover (LULC) data to determine the curve number (CN). As of the time of writing this chapter, new approaches are available and can be tested, including the possibility of using soil hydrological information for global purposes. For more information, visit <a href="https://gee-community-catalog.org/projects/hihydro_soil/">hihydro soil</a>.</p>
<p>In the original calculation presented by Santarosa et al.&nbsp;(2024), the textural information from SoilGrids was downloaded and processed to obtain the HSG information for the study area. The following steps will present the conceptualization of this process.</p>
<p>To download the SoilGrids information, see the accompanying Google Earth Engine <a href="https://github.com/lvsantarosa/Soil-Grid-on-Google-Earth-Engine">script</a>.</p>
<p>This process involves loading the information from SoilGrids and projecting it to the standard projection used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>soil <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">my_path</span>(<span class="st">'01_DADOS/00_SOIL/SOIL.tif'</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(soil) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'clay'</span>, <span class="st">'sand'</span>, <span class="st">'silt'</span>) </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>soil <span class="ot">&lt;-</span> soil <span class="sc">|&gt;</span> <span class="fu">project</span>(<span class="st">'EPSG:4326'</span>, <span class="at">method =</span> <span class="st">"mode"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(soil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="potential-recharge_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For verification of data, the sum of soil layers should to be equal to 1 for each pixel.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(soil) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="potential-recharge_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data/potential-recharge/HSG.jpg" class="img-fluid figure-img" alt="A descriptive alt text for the figure."></p>
<figcaption>Representations of actual and estimated points on the zones of the hydrologic soil group and the triangle of soil from Sayl et al.&nbsp;(2017)</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hydrologic Soil Group and Label used in the reclassification</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Hydrologic Soil Group </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  A  =   1 </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  B  =   2 </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  C  =   3 </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  D  =   4 </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>calculate_textural_triangle <span class="ot">=</span> <span class="cf">function</span>(clay, sand, silt) {</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">case_when</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    clay <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> sand <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> silt <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    ,clay <span class="sc">&gt;=</span> <span class="fl">0.35</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    ,clay <span class="sc">&gt;=</span> <span class="fl">0.25</span> <span class="sc">&amp;</span> sand <span class="sc">&lt;=</span> <span class="fl">0.45</span> <span class="sc">~</span> <span class="dv">4</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    ,clay <span class="sc">&gt;=</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> silt <span class="sc">&lt;=</span> <span class="fl">0.275</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    ,silt <span class="sc">&lt;=</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    ,clay <span class="sc">&lt;=</span> <span class="fl">0.075</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    ,sand <span class="sc">&lt;=</span> <span class="fl">0.575</span> <span class="sc">~</span> <span class="dv">2</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    ,<span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>soil_classified <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">app</span>(soil, <span class="at">fun =</span> <span class="cf">function</span>(x) <span class="fu">calculate_textural_triangle</span>(<span class="at">clay =</span> x[, <span class="dv">1</span>], <span class="at">sand =</span> x[,<span class="dv">2</span>], <span class="at">silt =</span> x[,<span class="dv">3</span>]))</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>soil_classified <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="potential-recharge_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="land-use-and-land-cover-lulc" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="land-use-and-land-cover-lulc"><span class="header-section-number">2.5.2</span> Land Use and Land Cover (LULC)</h3>
<p>Annual land cover data from MapBiomas, with a spatial resolution of 30 meters (Souza et al.&nbsp;2020), were incorporated to capture the dynamic temporal behavior in runoff estimation. This LULC data can be utilized for annual analysis and is available for multiple countries across South America where MapBiomas information is accessible.</p>
<p><a href="https://storage.googleapis.com/mapbiomas-public/initiatives/brasil/collection_9/lclu/coverage/brasil_coverage_2023.tif">MapBiomas LULC for Brazil</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">my_path</span>(<span class="st">'01_DADOS/01_LULC/'</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">'.tif$'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>uses <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list)) {</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  uses[[i]] <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(list[i]) <span class="sc">|&gt;</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>               terra<span class="sc">::</span><span class="fu">resample</span>(soil_classified, <span class="at">method =</span> <span class="st">'mode'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>               terra<span class="sc">::</span><span class="fu">as.int</span>()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(uses[[i]])</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 668, 628, 1  (nrow, ncol, nlyr)
resolution  : 0.0025, 0.0025  (x, y)
extent      : -49.86, -48.29, -22.49, -20.82  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 (EPSG:4326) 
source(s)   : memory
name        : brasil_coverage_2023 
min value   :                    3 
max value   :                   48 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mapbio_resample <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(uses)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>mapbio_resample[mapbio_resample <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(mapbio_resample[[<span class="dv">1</span>]]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="potential-recharge_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="reclassification-of-mapbiomas-according-to-scs-method" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="reclassification-of-mapbiomas-according-to-scs-method"><span class="header-section-number">2.5.3</span> Reclassification of MAPBIOMAS According to SCS Method</h3>
<p>For simplify the process, the LULC orinal data was reclassified to the SCS LULC classes the MapBimas values are agruped in 8 classes as presented in the Table 2.</p>
<p>Table 2. Classes of LULC used in SCS and the correspondent classes from MapBiomas</p>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<tbody>
<tr class="odd">
<td>SCS LULC</td>
<td>MapBiomas LULC</td>
</tr>
<tr class="even">
<td>Urban (10)</td>
<td>24</td>
</tr>
<tr class="odd">
<td>Agriculture (20)</td>
<td>14, 18, 19, 20, 21, 36, 39, 40, 41, 46, 47, 48, 62</td>
</tr>
<tr class="even">
<td>Forest (30)</td>
<td>1, 3, 4, 5, 49</td>
</tr>
<tr class="odd">
<td>Silviculture (40)</td>
<td>9</td>
</tr>
<tr class="even">
<td>Grassland (50)</td>
<td>12, 13, 32, 50</td>
</tr>
<tr class="odd">
<td>Uncover (60)</td>
<td>23, 25, 29, 30</td>
</tr>
<tr class="even">
<td>Pasture (70)</td>
<td>15</td>
</tr>
<tr class="odd">
<td>Water (100)</td>
<td>10, 27, 31, 33</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple replacements</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>class_map_scs <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">24</span>,  <span class="dv">10</span>), </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="dv">14</span>,  <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">36</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">39</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">41</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">46</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">47</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">48</span>, <span class="dv">20</span>), <span class="fu">c</span>(<span class="dv">62</span>, <span class="dv">20</span>), </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="dv">1</span> ,  <span class="dv">30</span>), <span class="fu">c</span>(<span class="dv">3</span> , <span class="dv">30</span>), <span class="fu">c</span>(<span class="dv">4</span> , <span class="dv">30</span>), <span class="fu">c</span>(<span class="dv">5</span> , <span class="dv">30</span>), <span class="fu">c</span>(<span class="dv">49</span>, <span class="dv">30</span>), </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="dv">9</span> ,  <span class="dv">40</span>), </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="dv">12</span>,  <span class="dv">50</span>), <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">50</span>), <span class="fu">c</span>(<span class="dv">32</span>, <span class="dv">50</span>), <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">50</span>), </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="dv">23</span>,  <span class="dv">60</span>), <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">60</span>), <span class="fu">c</span>(<span class="dv">29</span>, <span class="dv">60</span>), <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">60</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="dv">15</span>,  <span class="dv">70</span>),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">100</span>), <span class="fu">c</span>(<span class="dv">27</span>, <span class="dv">100</span>), <span class="fu">c</span>(<span class="dv">31</span>, <span class="dv">100</span>), <span class="fu">c</span>(<span class="dv">33</span>, <span class="dv">100</span>))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>rc_map_scs <span class="ot">=</span> <span class="fu">classify</span>(mapbio_resample, class_map_scs)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>rc_map_scs[rc_map_scs <span class="sc">&lt;</span> <span class="dv">10</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(rc_map_scs[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="potential-recharge_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="curve-number-cn-classification" class="level3" data-number="2.5.4">
<h3 data-number="2.5.4" class="anchored" data-anchor-id="curve-number-cn-classification"><span class="header-section-number">2.5.4</span> Curve Number (CN) Classification</h3>
<p>By reclassifying the HSG and LULC (Land Use and Land Cover) data, the CN map can be produced. Table 3 presents the intersection of HSG and LULC data to derive the CN values used in the SCS method.</p>
<p>Table 3: Curve Number values based on the combination of LULC and HSG data.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Land Use / Soil Type</th>
<th style="text-align: center;">A</th>
<th style="text-align: center;">B</th>
<th style="text-align: center;">C</th>
<th style="text-align: center;">D</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Urban</td>
<td style="text-align: center;">89</td>
<td style="text-align: center;">92</td>
<td style="text-align: center;">94</td>
<td style="text-align: center;">95</td>
</tr>
<tr class="even">
<td style="text-align: center;">Crops</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;">75</td>
<td style="text-align: center;">82</td>
<td style="text-align: center;">85</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Forest</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">55</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">77</td>
</tr>
<tr class="even">
<td style="text-align: center;">Silviculture</td>
<td style="text-align: center;">45</td>
<td style="text-align: center;">66</td>
<td style="text-align: center;">77</td>
<td style="text-align: center;">86</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Herbaceous</td>
<td style="text-align: center;">48</td>
<td style="text-align: center;">62</td>
<td style="text-align: center;">71</td>
<td style="text-align: center;">85</td>
</tr>
<tr class="even">
<td style="text-align: center;">Bare Soil</td>
<td style="text-align: center;">77</td>
<td style="text-align: center;">86</td>
<td style="text-align: center;">91</td>
<td style="text-align: center;">94</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Pasture</td>
<td style="text-align: center;">39</td>
<td style="text-align: center;">61</td>
<td style="text-align: center;">74</td>
<td style="text-align: center;">80</td>
</tr>
<tr class="even">
<td style="text-align: center;">No Data</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>class_cn <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">89</span>), <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">92</span>), <span class="fu">c</span>(<span class="dv">13</span>,<span class="dv">94</span>), <span class="fu">c</span>(<span class="dv">14</span>,<span class="dv">95</span>), </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">21</span>,<span class="dv">64</span>), <span class="fu">c</span>(<span class="dv">22</span>,<span class="dv">75</span>), <span class="fu">c</span>(<span class="dv">23</span>,<span class="dv">82</span>), <span class="fu">c</span>(<span class="dv">24</span>,<span class="dv">85</span>), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">31</span>,<span class="dv">30</span>), <span class="fu">c</span>(<span class="dv">32</span>,<span class="dv">55</span>), <span class="fu">c</span>(<span class="dv">33</span>,<span class="dv">70</span>), <span class="fu">c</span>(<span class="dv">34</span>,<span class="dv">77</span>), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">41</span>,<span class="dv">45</span>), <span class="fu">c</span>(<span class="dv">42</span>,<span class="dv">66</span>), <span class="fu">c</span>(<span class="dv">43</span>,<span class="dv">77</span>), <span class="fu">c</span>(<span class="dv">44</span>,<span class="dv">86</span>), </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">51</span>,<span class="dv">48</span>), <span class="fu">c</span>(<span class="dv">52</span>,<span class="dv">62</span>), <span class="fu">c</span>(<span class="dv">53</span>,<span class="dv">71</span>), <span class="fu">c</span>(<span class="dv">54</span>,<span class="dv">85</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">61</span>,<span class="dv">77</span>), <span class="fu">c</span>(<span class="dv">62</span>,<span class="dv">86</span>), <span class="fu">c</span>(<span class="dv">63</span>,<span class="dv">91</span>), <span class="fu">c</span>(<span class="dv">64</span>,<span class="dv">94</span>), </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">71</span>,<span class="dv">39</span>), <span class="fu">c</span>(<span class="dv">72</span>,<span class="dv">61</span>), <span class="fu">c</span>(<span class="dv">73</span>,<span class="dv">74</span>), <span class="fu">c</span>(<span class="dv">74</span>,<span class="dv">80</span>), </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">101</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">102</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">103</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">104</span>,<span class="dv">0</span>), </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">0</span> ), <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">0</span> ), <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">0</span> ), <span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">0</span> ), </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">0</span> ), <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">0</span> ), <span class="fu">c</span>(<span class="dv">70</span>,<span class="dv">0</span> ), <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">0</span>))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Reclassify</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>sum_soil_uses <span class="ot">=</span> soil_classified  <span class="sc">+</span> rc_map_scs</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sum_soil_uses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="potential-recharge_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cn_final <span class="ot">=</span> <span class="fu">classify</span>(sum_soil_uses, class_cn)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Nomes = seq(from = 2000, to = 2021) </span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use year as names for each CN in case of more than one year of analysis</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>Nomes <span class="ot">=</span> <span class="dv">2023</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cn_final) <span class="ot">=</span> Nomes</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>cn_final[cn_final <span class="sc">&lt;</span> <span class="dv">30</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(cn_final[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="potential-recharge_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export Results</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">=</span> <span class="fu">my_path</span>(<span class="st">"02_RESULTADOS/CN_{Nomes}.tif"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>cn_final <span class="sc">|&gt;</span> <span class="fu">writeRaster</span>(<span class="at">filename =</span> filename, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="process-the-hydrological-data" class="level3" data-number="2.5.5">
<h3 data-number="2.5.5" class="anchored" data-anchor-id="process-the-hydrological-data"><span class="header-section-number">2.5.5</span> Process the hydrological data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mask <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="fu">my_path</span>(<span class="st">'02_RESULTADOS/CN_2023.tif'</span>)) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">resample</span>(soil) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">trim</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the time according with the period</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">'2023/01/01'</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>en <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">'2023/12/31'</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>Date <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> st, <span class="at">to =</span> en, <span class="at">by=</span> <span class="st">'day'</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>Date2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> st, <span class="at">to =</span> en, <span class="at">by=</span> <span class="st">'month'</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>Year <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2023</span>, <span class="at">to =</span> <span class="dv">2023</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-1-a-organize-the-daily-data-set" class="level3" data-number="2.5.6">
<h3 data-number="2.5.6" class="anchored" data-anchor-id="step-1-a-organize-the-daily-data-set"><span class="header-section-number">2.5.6</span> STEP 1-A Organize the daily data set</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rain_day_lst <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="fu">my_path</span>(<span class="st">'01_DADOS/02_PRECIPITATION/'</span>), <span class="at">pattern =</span> <span class="st">'.nc4'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(rain_day_lst)) {</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  rain1 <span class="ot">=</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">rast</span>(rain_day_lst[i]) <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(<span class="st">'EPSG:4326'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">t</span>() <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">flip</span>(<span class="at">direction =</span> <span class="st">'horizontal'</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">flip</span>(<span class="at">direction =</span> <span class="st">'vertical'</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">resample</span>(mask) <span class="sc">|&gt;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">mask</span>(mask)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  file_rf1 <span class="ot">=</span> <span class="fu">my_path</span>(<span class="st">'temp/Rainfall_GPM_day_ret_{Date[i]}.tif'</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(rain1, <span class="at">filename =</span> file_rf1 , <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-1-b-convert-daily-rainfall-in-monthly" class="level3" data-number="2.5.7">
<h3 data-number="2.5.7" class="anchored" data-anchor-id="step-1-b-convert-daily-rainfall-in-monthly"><span class="header-section-number">2.5.7</span> STEP 1-B Convert daily rainfall in monthly</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rain_day_lst_res <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="fu">my_path</span>(<span class="st">'temp/'</span>), <span class="at">pattern =</span> <span class="st">'GPM_day_ret_.*</span><span class="sc">\\</span><span class="st">.tif$'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>table_day_rain <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">data.frame</span>(Date, rain_day_lst_res)) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span>  lubridate<span class="sc">::</span><span class="fu">year</span>(Date))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>table_date     <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">data.frame</span>(Date2))<span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span>  lubridate<span class="sc">::</span><span class="fu">year</span>(Date2))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Year)) {</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  Y       <span class="ot">&lt;-</span> Year[i]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  sel_rn1 <span class="ot">&lt;-</span> table_day_rain <span class="sc">|&gt;</span> <span class="fu">filter</span>(Year <span class="sc">==</span> Y)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  rain <span class="ot">=</span>  terra<span class="sc">::</span><span class="fu">rast</span>(sel_rn1<span class="sc">$</span>rain_day_lst_res)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">time</span>(rain)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(d, <span class="st">"%m"</span>))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(d, <span class="st">"%Y"</span>))</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  ym <span class="ot">&lt;-</span> <span class="fu">paste0</span>(y, m)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  rain_m <span class="ot">&lt;-</span> <span class="fu">tapp</span>(rain, ym, sum)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  sel_dt <span class="ot">&lt;-</span> table_date <span class="sc">|&gt;</span> <span class="fu">filter</span>(Year <span class="sc">==</span> Y)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(rain_m) <span class="ot">=</span> sel_dt<span class="sc">$</span>Date2</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  file_rf <span class="ot">=</span> <span class="fu">my_path</span>(<span class="st">'temp/Rainfall_GPM_month_{sel_dt$Date2}.tif'</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(rain_m, <span class="at">filename =</span> file_rf , <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(sel_dt$Date2)</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-resample-curve-number" class="level3" data-number="2.5.8">
<h3 data-number="2.5.8" class="anchored" data-anchor-id="step-2-resample-curve-number"><span class="header-section-number">2.5.8</span> STEP 2 Resample Curve Number</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cn_lst1 <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="fu">my_path</span>(<span class="st">'02_RESULTADOS/'</span>), <span class="at">pattern =</span> <span class="st">'CN.*</span><span class="sc">\\</span><span class="st">.tif$'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>cn1 <span class="ot">&lt;-</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>(cn_lst1) <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">resample</span>(mask) <span class="sc">|&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">mask</span>(mask) <span class="sc">|&gt;</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">as.int</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">trim</span>()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>file_cn <span class="ot">=</span> <span class="fu">my_path</span>(<span class="st">'temp/CN_res_{Year}.tif'</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(cn1, <span class="at">filename =</span> file_cn , <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-3-runoff-calculation" class="level3" data-number="2.5.9">
<h3 data-number="2.5.9" class="anchored" data-anchor-id="step-3-runoff-calculation"><span class="header-section-number">2.5.9</span> STEP 3 Runoff calculation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rain_day_lst_res <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">'temp'</span>, <span class="at">pattern =</span> <span class="st">'GPM_day_ret_.*</span><span class="sc">\\</span><span class="st">.tif$'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>cn_lst <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="fu">my_path</span>(<span class="st">'temp'</span>), <span class="at">pattern =</span> <span class="st">'CN_res.*</span><span class="sc">\\</span><span class="st">.tif$'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="do">## arrumar aqui!!</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>table_day_rain <span class="ot">&lt;-</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">Year =</span> Date[<span class="fu">seq_along</span>(rain_day_lst_res)], <span class="at">X =</span> rain_day_lst_res)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>table_merge    <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">data.frame</span>(Year, cn_lst)) <span class="sc">|&gt;</span> <span class="fu">merge</span>(table_day_rain, <span class="at">by =</span> <span class="st">'Year'</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#If you need stat again or use another interval can change this object</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Year &lt;- seq(from = 2017, to = 2021)</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Date)) {</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  cn_lst    <span class="ot">&lt;-</span> table_merge<span class="sc">$</span>cn_lst</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  cn        <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(cn_lst[i])</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  rain_lst  <span class="ot">&lt;-</span> table_merge<span class="sc">$</span>rain_day_lst_res</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  rainfall  <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(rain_lst[i]) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">resample</span>(cn)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">=</span> (<span class="dv">25400</span> <span class="sc">/</span> cn) <span class="sc">-</span> <span class="dv">254</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  ia <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">*</span>s</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  runoff    <span class="ot">&lt;-</span> ((rainfall <span class="sc">-</span> ia)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(rainfall <span class="sc">-</span> ia <span class="sc">+</span> s)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  runoff[ia <span class="sc">&gt;</span> rainfall] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  name_rf   <span class="ot">&lt;-</span> Date</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(runoff[[<span class="dv">1</span>]]) <span class="ot">&lt;-</span> name_rf[i]</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  file_rf <span class="ot">=</span> <span class="fu">glue</span>(<span class="st">'temp/Runoff_{name_rf[i]}.tif'</span>)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(runoff[[<span class="dv">1</span>]], <span class="at">filename =</span> file_rf , <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(runoff)</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Runoff from day to month</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>roff_day_lst_res <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">'temp/'</span>, <span class="at">pattern =</span> <span class="st">'Runoff.*</span><span class="sc">\\</span><span class="st">.tif$'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>roff <span class="ot">=</span>  terra<span class="sc">::</span><span class="fu">rast</span>(roff_day_lst_res)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(roff))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(d, <span class="st">"%m"</span>))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(d, <span class="st">"%Y"</span>))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>ym <span class="ot">&lt;-</span> <span class="fu">paste0</span>(y, m)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>roff_m <span class="ot">&lt;-</span> <span class="fu">tapp</span>(roff, ym, sum)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(roff_m) <span class="ot">=</span> Date2</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>file_rf <span class="ot">=</span> <span class="fu">glue</span>(<span class="st">'temp/Runoff_month_{Date2}.tif'</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(roff_m, <span class="at">filename =</span> file_rf , <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-4-monthly-recharge-calculation" class="level3" data-number="2.5.10">
<h3 data-number="2.5.10" class="anchored" data-anchor-id="step-4-monthly-recharge-calculation"><span class="header-section-number">2.5.10</span> STEP 4 Monthly recharge calculation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>et_m_lst   <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">'01_DADOS/03_EVAPOTRANSPIRATION/'</span>, <span class="at">pattern =</span> <span class="st">'.SUB'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>rain_m_lst <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">'temp/'</span>, <span class="at">pattern =</span> <span class="st">'GPM_month.*</span><span class="sc">\\</span><span class="st">.tif$'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>roff_m_lst <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">'temp/'</span>, <span class="at">pattern =</span> <span class="st">'Runoff_month_.*</span><span class="sc">\\</span><span class="st">.tif$'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>Rff <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>Etp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>Prc <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Import results and resample all layer</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Date2)) {</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  Rff[[i]] <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(roff_m_lst[i]) <span class="sc">|&gt;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">resample</span>(mask) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">mask</span>(mask)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">names</span>(Rff[[i]]))</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  Etp[[i]] <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(et_m_lst[i]) <span class="sc">|&gt;</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">resample</span>(mask) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">mask</span>(mask)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Etp[[i]]) <span class="ot">&lt;-</span>Date2[i]</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">names</span>(Etp[[i]]))</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  Prc[[i]] <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(rain_m_lst[i]) <span class="sc">|&gt;</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">resample</span>(mask) <span class="sc">|&gt;</span> terra<span class="sc">::</span><span class="fu">mask</span>(mask)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(names(Prc[[i]]))</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recharge calculation</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Date2)) {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  PRC <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(Prc[i])</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  ETP <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(Etp[i])</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  ETP <span class="ot">&lt;-</span> ETP<span class="sc">*</span>(<span class="dv">60</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">30</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  RFF <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(Rff[i])</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  Recharge <span class="ot">=</span>  PRC <span class="sc">-</span> (ETP <span class="sc">+</span> RFF)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  Recharge[Recharge <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print(Recharge)</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  file_rc <span class="ot">=</span> <span class="fu">glue</span>(<span class="st">'temp/Recharge_{Date2[i]}.tif'</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(Recharge, <span class="at">filename =</span> file_rc , <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print('Save!')</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From month to year</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>rec_lst_res <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">'temp/'</span>, <span class="at">pattern =</span> <span class="st">'Recharge_.*</span><span class="sc">\\</span><span class="st">.tif$'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">=</span>  terra<span class="sc">::</span><span class="fu">rast</span>(rec_lst_res)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(rec))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(d, <span class="st">"%Y"</span>))</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>rec_y <span class="ot">&lt;-</span> <span class="fu">tapp</span>(rec, y, sum)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rec_y) <span class="ot">=</span> Year</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>file_rc <span class="ot">=</span> <span class="fu">glue</span>(<span class="st">'02_RESULTADOS/Recharge_year_{Year}.tif'</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeRaster</span>(rec_y, <span class="at">filename =</span> file_rc , <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rec_y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clean-temp-files" class="level3" data-number="2.5.11">
<h3 data-number="2.5.11" class="anchored" data-anchor-id="clean-temp-files"><span class="header-section-number">2.5.11</span> CLEAN TEMP FILES</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(<span class="at">x =</span> <span class="fu">list.files</span>(<span class="st">'temp'</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./summary.html" class="pagination-link" aria-label="Summary">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Summary</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Criado por …</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/vituri/water-in-movement/edit/main/potential-recharge.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>